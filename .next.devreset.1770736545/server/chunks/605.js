exports.id=605,exports.ids=[605],exports.modules={95:(a,b,c)=>{"use strict";c.d(b,{a:()=>g,g:()=>h});var d=c(7598);let e=process.env.CLAWBOARD_TOKEN_SECRET??"clawboard-dev-secret",f=a=>(0,d.createHmac)("sha256",e).update(a).digest("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),g=a=>{let b,c=(b=JSON.stringify({sub:a,iat:Math.floor(Date.now()/1e3)}),Buffer.from(b,"utf8").toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"));return`${c}.${f(c)}`},h=a=>{let[b,c]=a.split(".");if(!b||!c||f(b)!==c)return null;try{let a=JSON.parse((a=>{let b=a.replace(/-/g,"+").replace(/_/g,"/"),c=b.length%4==0?"":"=".repeat(4-b.length%4);return Buffer.from(b+c,"base64").toString("utf8")})(b));if(!a.sub||"string"!=typeof a.sub)return null;return a}catch{return null}}},6487:()=>{},7939:(a,b,c)=>{"use strict";c.d(b,{Cb:()=>h,Ee:()=>i,TK:()=>g,kg:()=>e,kl:()=>f});let d=()=>(globalThis.__clawboardStore||(globalThis.__clawboardStore={users:new Map}),globalThis.__clawboardStore),e=a=>(d().users.set(a.id,a),a),f=a=>d().users.get(a),g=(a,b)=>{let c=d(),e=c.users.get(a);if(!e)return null;let f={...e,...b};return c.users.set(a,f),f},h=(a,b)=>g(a,{stats:b}),i=(a,b)=>Array.from(d().users.values()).filter(a=>a.shareEnabled&&a.stats).map(c=>({anonymousId:c.anonymousId,value:((a,b,c)=>{if(!a.stats)return 0;if("streak"===b)return a.stats.streak;let d=a.stats.periods[c];switch(b){case"tokens":return d.tokens;case"cost":return d.cost;case"messages":return d.messages;case"sessions":return d.sessions;default:return 0}})(c,a,b),claimed:c.claimed,identity:c.identity})).sort((a,b)=>b.value-a.value).slice(0,100).map((a,b)=>({rank:b+1,...a}))},8335:()=>{},9613:(a,b,c)=>{"use strict";c.d(b,{S:()=>K,Z:()=>J});var d=c(7598),e=c.n(d),f=c(3024),g=c(6760),h=c.n(g);let i=()=>h().join(process.cwd(),".clawboard","device.json"),j=async()=>{try{let a=await f.promises.readFile(i(),"utf-8"),b=JSON.parse(a);if("string"!=typeof b.deviceId||"string"!=typeof b.publicKey||"string"!=typeof b.privateKey)return null;return{deviceId:b.deviceId,publicKey:b.publicKey,privateKey:b.privateKey}}catch{return null}},k=async a=>{let b=i();await f.promises.mkdir(h().dirname(b),{recursive:!0}),await f.promises.writeFile(b,JSON.stringify(a,null,2),"utf-8")},l=async()=>{let a=await j();if(a)return a;let b=(()=>{let{publicKey:a,privateKey:b}=e().generateKeyPairSync("ed25519"),c=a.export({type:"spki",format:"der"}).subarray(-32),d=b.export({type:"pkcs8",format:"der"}).subarray(-32);return{deviceId:e().createHash("sha256").update(c).digest("hex"),publicKey:c.toString("base64url"),privateKey:d.toString("base64url")}})();return await k(b),b},m=async a=>{let b=Date.now(),c=(a=>["v1",a.deviceId,a.clientId,a.clientMode,a.role,a.scopes.join(","),String(a.signedAtMs),a.token].join("|"))({deviceId:a.identity.deviceId,clientId:a.clientId,clientMode:a.clientMode,role:a.role,scopes:a.scopes,signedAtMs:b,token:a.token}),d=Buffer.from(a.identity.privateKey,"base64url"),f=Buffer.from("302e020100300506032b657004220420","hex"),g=Buffer.concat([f,d]),h=e().createPrivateKey({key:g,format:"der",type:"pkcs8"}),i=e().sign(null,Buffer.from(c,"utf-8"),h);return{id:a.identity.deviceId,publicKey:a.identity.publicKey,signature:i.toString("base64url"),signedAt:b}},n=1e4,o="true"===process.env.CLAWBOARD_ALLOW_MOCK_STATS,p="gateway-client",q="backend",r="operator",s=["operator.read","operator.write","operator.admin"],t=a=>`${a}_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,u=a=>"number"==typeof a&&Number.isFinite(a)?a:0,v=a=>new Date(a).toISOString().slice(0,10),w=async a=>{if("string"==typeof a)return a;if("undefined"!=typeof Blob&&a instanceof Blob){let b=await a.arrayBuffer();return Buffer.from(b).toString()}return Buffer.isBuffer(a)?a.toString():Array.isArray(a)&&a.every(a=>Buffer.isBuffer(a))?Buffer.concat(a).toString():a instanceof ArrayBuffer?Buffer.from(a).toString():ArrayBuffer.isView(a)?Buffer.from(a.buffer,a.byteOffset,a.byteLength).toString():String(a)},x=a=>{if(!a)return 0;let b=u(a.input)+u(a.output)+u(a.cacheRead)+u(a.cacheWrite);return b>0?b:u(a.totalTokens)},y=a=>u(a.usage?.totalTokens??a.totalTokens),z=a=>u(a.usage?.totalCost??a.totalCost),A=a=>u(a.usage?.messageCounts?.total??a.messages),B=a=>u(a.usage?.lastActivity??a.updatedAt),C=(a,b)=>{let c=new Date(`${a}T00:00:00`);return c.setDate(c.getDate()+b),c.toISOString().slice(0,10)},D=(a,b)=>{if(a&&a.length>0){let b=a.map(a=>({date:a.date,tokens:u(a.tokens),cost:u(a.cost),messages:u(a.messages)})).sort((a,b)=>a.date.localeCompare(b.date));if(b.length>0)return b}return(a=>{let b=new Map;for(let c of a){let a=B(c);if(!a)continue;let d=v(a),e=b.get(d)??{date:d,tokens:0,cost:0,messages:0};b.set(d,{date:d,tokens:e.tokens+y(c),cost:e.cost+z(c),messages:e.messages+A(c)})}return[...b.values()].sort((a,b)=>a.date.localeCompare(b.date))})(b)},E=a=>{let b=D(a.aggregates?.daily,a.sessions);return{tokens:Math.round(x(a.totals)),cost:Number((a=>{if(!a)return 0;let b=u(a.inputCost)+u(a.outputCost)+u(a.cacheReadCost)+u(a.cacheWriteCost);return b>0?b:u(a.totalCost)})(a.totals).toFixed(2)),messages:Math.round(((a,b)=>u(a.aggregates?.messages?.total)||b.reduce((a,b)=>a+b.messages,0)||a.sessions.reduce((a,b)=>a+A(b),0))(a,b)),sessions:a.sessions.length}},F=async(a,b)=>{let c=await H(a,"sessions.usage",b);if(!c||!Array.isArray(c.sessions)||!c.totals)throw Error("sessions.usage response is missing expected fields.");return c},G=async a=>{let b=await l(),c=a.apiKey??"",d=await m({identity:b,clientId:p,clientMode:q,role:r,scopes:s,token:c});return{minProtocol:3,maxProtocol:3,client:{id:p,displayName:"ClawBoard",version:"0.1.0",platform:"node",mode:q,instanceId:`clawboard-${process.pid}`},role:r,scopes:s,device:d,...c?{auth:{token:c}}:{}}},H=async(a,b,c,d=n)=>{let e=await G(a),f=(a=>{let b=a.trim().replace(/\/+$/,"");if(/^wss?:\/\//i.test(b))return b;if(/^https?:\/\//i.test(b)){let a=new URL(b),c="https:"===a.protocol?"wss:":"ws:";return`${c}//${a.host}${a.pathname}`.replace(/\/+$/,"")}return`ws://${b}`})(a.gatewayUrl);return new Promise((a,g)=>{let h,i=t("connect"),j=t("req"),k=!1,l=!1,m=new WebSocket(f),n=a=>{k||(k=!0,h&&clearTimeout(h),a())};h=setTimeout(()=>{n(()=>{try{m.close()}catch{}g(Error(`Gateway request timed out after ${d}ms`))})},d),m.onopen=()=>{m.send(JSON.stringify({type:"req",id:i,method:"connect",params:e}))},m.onmessage=async d=>{let e;if(!k){try{e=JSON.parse(await w(d.data))}catch{return}if("res"===e.type){if(!l&&e.id===i){if(e.error){let a=e.error;n(()=>g(Error(`Gateway handshake failed: ${a.message}`)));return}l=!0,m.send(JSON.stringify({type:"req",id:j,method:b,...c?{params:c}:{}}));return}l&&e.id===j&&n(()=>{try{m.close()}catch{}if(e.error){let a=e.error;g(Error(`Gateway error [${a.code}]: ${a.message}`));return}a(e.payload??e.result)})}}},m.onerror=a=>{n(()=>{let b="error"in a&&a.error instanceof Error?a.error:null;g(Error(b?.message??"Gateway connection error"))})},m.onclose=()=>{k||n(()=>{g(Error("Gateway connection closed unexpectedly"))})}})},I=(a,b,c)=>{let d=0;for(let b=0;b<a.length;b+=1)d=(31*d+a.charCodeAt(b))%0x7fffffff;return b+d%(c-b+1)},J=async a=>{try{let b=await H(a,"agents.list"),c=(a=>(a&&"object"==typeof a&&"agents"in a&&Array.isArray(a.agents)?a.agents:Array.isArray(a)?a:[]).filter(a=>!!a&&"object"==typeof a).map(a=>{let b="string"==typeof a.id?a.id:"agent:unknown",c="string"==typeof a.name&&a.name.length>0?a.name:b;return{id:b,name:c,status:"active"}}))(b);if(c.length>0)return c;throw Error("Gateway returned an empty agents list.")}catch(b){if(o)return[{id:"agent:main",name:"Main Agent",status:"active"}];let a=b instanceof Error?b.message:"Unknown gateway error";throw Error(`Unable to connect to gateway: ${a}`)}},K=async a=>{try{let b=new Date().toISOString().slice(0,10),c=C(b,-6),d=C(b,-29),e=process.env.CLAWBOARD_ALL_TIME_START_DATE||"1970-01-01",[f,g,h,i]=await Promise.all([F(a,{startDate:e,endDate:b,limit:1e5}),F(a,{startDate:b,endDate:b,limit:2e4}),F(a,{startDate:c,endDate:b,limit:2e4}),F(a,{startDate:d,endDate:b,limit:2e4})]),j={"24h":E(g),"7d":E(h),"30d":E(i),all:E(f)},k=D(i.aggregates?.daily,i.sessions);return{totalTokens:j.all.tokens,totalCost:j.all.cost,messageCount:j.all.messages,sessionCount:j.all.sessions,topModels:(a=>{let b=a.aggregates?.byModel?.map(a=>({model:[a.provider,a.model].filter(Boolean).join("/")||"unknown",tokens:Math.round(x(a.totals))})).filter(a=>a.tokens>0).sort((a,b)=>b.tokens-a.tokens).slice(0,5);if(b&&b.length>0)return b;let c=new Map;for(let b of a.sessions){let a=b.model||"unknown";c.set(a,(c.get(a)??0)+y(b))}return[...c.entries()].map(([a,b])=>({model:a,tokens:Math.round(b)})).sort((a,b)=>b.tokens-a.tokens).slice(0,5)})(f),topTools:(a=>{let b=a.aggregates?.tools?.tools?.map(a=>({tool:a.name||"unknown",count:Math.round(u(a.count))})).sort((a,b)=>b.count-a.count).slice(0,5);if(b&&b.length>0)return b;let c=new Map;for(let b of a.sessions)for(let a of b.usage?.toolUsage?.tools??[]){let b=a.name||"unknown";c.set(b,(c.get(b)??0)+u(a.count))}return c.size>0?[...c.entries()].map(([a,b])=>({tool:a,count:Math.round(b)})).sort((a,b)=>b.count-a.count).slice(0,5):[{tool:"tool_calls",count:a.sessions.reduce((a,b)=>a+(a=>u(a.usage?.messageCounts?.toolCalls??a.usage?.toolUsage?.totalCalls))(b),0)}]})(f),activity:(a=>{if(a.length>0)return a.slice(-35).map(a=>({date:a.date,messages:Math.round(a.messages)}));let b=new Date;return Array.from({length:35}).map((a,c)=>{let d=new Date(b);return d.setDate(b.getDate()-(34-c)),{date:d.toISOString().slice(0,10),messages:0}})})(k),periods:j}}catch(c){if(o)return(a=>{let b=I(`${a}:tokens`,5e4,2e6),c=I(`${a}:messages`,300,9e3),d=I(`${a}:sessions`,20,900),e=Number((b/1e6*2.4).toFixed(2)),f=[{model:"claude-sonnet",tokens:Math.floor(.42*b)},{model:"gpt-4o",tokens:Math.floor(.31*b)},{model:"o3-mini",tokens:Math.floor(.17*b)},{model:"llama-3.3",tokens:Math.floor(.1*b)}],g=[{tool:"exec",count:Math.floor(.35*c)},{tool:"web.search",count:Math.floor(.2*c)},{tool:"read_file",count:Math.floor(.18*c)},{tool:"write_file",count:Math.floor(.13*c)},{tool:"git",count:Math.floor(.1*c)}],h=new Date;return{totalTokens:b,totalCost:e,messageCount:c,sessionCount:d,topModels:f,topTools:g,activity:Array.from({length:35}).map((b,c)=>{let d=new Date(h);d.setDate(h.getDate()-(34-c));let e=I(`${a}:${d.toISOString().slice(0,10)}`,0,50);return{date:d.toISOString().slice(0,10),messages:e}})}})(`${a.gatewayUrl}:${a.apiKey??""}`);let b=c instanceof Error?c.message:"Unknown gateway error";throw Error(`Unable to fetch usage from gateway: ${b}`)}}}};