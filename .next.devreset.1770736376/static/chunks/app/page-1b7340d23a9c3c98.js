(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{63:(e,t,a)=>{"use strict";var o=a(7260);a.o(o,"useParams")&&a.d(t,{useParams:function(){return o.useParams}}),a.o(o,"useRouter")&&a.d(t,{useRouter:function(){return o.useRouter}})},1213:(e,t,a)=>{Promise.resolve().then(a.bind(a,8746)),Promise.resolve().then(a.t.bind(a,2619,23))},8746:(e,t,a)=>{"use strict";a.d(t,{ConnectForm:()=>i});var o=a(5155),r=a(63),n=a(2115);let s=["http://127.0.0.1:18888","http://localhost:18888","http://127.0.0.1:18889","http://localhost:18889"],l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1200,o=new AbortController,r=setTimeout(()=>o.abort(),a);try{return await fetch(e,{...t,signal:o.signal,cache:"no-store"})}finally{clearTimeout(r)}},c=async()=>{for(let e of s)try{let t=await l("".concat(e).concat("/v1/clawboard/discovery"));if(!t.ok)continue;let a=await t.json();if(!a||"object"!=typeof a)continue;return{origin:e,name:"string"==typeof a.name&&a.name.length>0?a.name:"Local Connector",version:"string"==typeof a.version&&a.version.length>0?a.version:"unknown",gatewayUrl:"string"==typeof a.gatewayUrl?a.gatewayUrl:void 0,hasGatewayToken:a.hasGatewayToken}}catch(e){}return null};function i(){let e=(0,r.useRouter)(),[t,a]=(0,n.useState)("ws://127.0.0.1:18789"),[s,i]=(0,n.useState)(""),[d,u]=(0,n.useState)(!1),[y,p]=(0,n.useState)(null),[m,h]=(0,n.useState)("probing"),[w,x]=(0,n.useState)(null),g=async(t,a)=>{var o,r,n;let s=await fetch("/api/connect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gatewayUrl:t.gatewayUrl,apiKey:null!=(o=t.apiKey)?o:""})});if(!s.ok)throw Error(null!=(r=(await s.json()).error)?r:"Failed to connect");let l=await s.json();localStorage.setItem("clawboard.token",l.anonymousToken),localStorage.setItem("clawboard.gatewayUrl",t.gatewayUrl),a.persistApiKey&&t.apiKey?localStorage.setItem("clawboard.apiKey",t.apiKey):localStorage.removeItem("clawboard.apiKey");let c=await fetch("/api/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({anonymousToken:l.anonymousToken,gatewayUrl:t.gatewayUrl,...t.apiKey?{apiKey:t.apiKey}:{}})});if(!c.ok)throw Error(null!=(n=(await c.json()).error)?n:"Connected but failed to sync usage");e.push("/dashboard")};(0,n.useEffect)(()=>{let e=!0;return(async()=>{let t=await c();if(e){if(!t){h("missing"),x(null);return}x(t),h("found"),t.gatewayUrl&&a(t.gatewayUrl)}})(),()=>{e=!1}},[]);let b=async e=>{e.preventDefault(),p(null),u(!0);try{await g({gatewayUrl:t,apiKey:s},{persistApiKey:!0})}catch(e){p(e instanceof Error?e.message:"Network error while connecting")}finally{u(!1)}},f=async()=>{if(w){p(null),u(!0);try{var e,t;let a=await l("".concat(w.origin).concat("/v1/clawboard/session"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scope:"usage.read"})},4e3);if(!a.ok){let t=await a.json().catch(()=>({}));throw Error(null!=(e=t.error)?e:"Local connector is reachable but session request failed")}let o=await a.json(),r=null!=(t=o.gatewayUrl)?t:w.gatewayUrl;if(!r)throw Error("Local connector did not provide a gateway URL");await g({gatewayUrl:r,apiKey:o.apiKey},{persistApiKey:!1})}catch(e){p(e instanceof Error?e.message:"One-click connector flow failed")}finally{u(!1)}}};return(0,o.jsxs)("form",{onSubmit:b,className:"oc-panel space-y-5 p-5 md:p-6",children:[(0,o.jsxs)("section",{className:"rounded-xl border border-[color:var(--border-subtle)] bg-[color:var(--coral-soft)] p-4",children:[(0,o.jsx)("p",{className:"oc-kicker",children:"One-Click Local Connect"}),"probing"===m?(0,o.jsx)("p",{className:"mt-2 text-sm text-[color:var(--text-secondary)]",children:"Searching for your local ClawBoard connector..."}):null,"found"===m&&w?(0,o.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,o.jsxs)("p",{className:"text-sm text-[color:var(--text-secondary)]",children:["Detected ",(0,o.jsx)("span",{className:"font-semibold text-white",children:w.name})," v",w.version," at"," ",w.origin]}),(0,o.jsx)("button",{type:"button",disabled:d,onClick:f,className:"oc-button-primary w-full px-4 py-2.5 text-sm",children:d?"Connecting...":"Connect Local OpenClaw"})]}):null,"missing"===m?(0,o.jsx)("p",{className:"mt-2 text-sm text-[color:var(--text-secondary)]",children:"Local connector not found. Use the manual fallback below."}):null]}),(0,o.jsxs)("section",{className:"rounded-xl border border-[color:var(--border-subtle)] bg-[color:var(--bg-surface)] p-4",children:[(0,o.jsx)("p",{className:"oc-kicker",children:"Manual Connect (Advanced)"}),(0,o.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,o.jsx)("label",{htmlFor:"gateway-url",className:"block text-xs uppercase tracking-[0.18em] text-[color:var(--text-muted)]",children:"Gateway URL"}),(0,o.jsx)("input",{id:"gateway-url",type:"text",value:t,onChange:e=>a(e.target.value),placeholder:"ws://127.0.0.1:18789",className:"oc-input",required:!0}),(0,o.jsxs)("p",{className:"text-xs text-[color:var(--text-muted)]",children:["Tip: ",(0,o.jsx)("code",{children:"http://"})," values are converted to ",(0,o.jsx)("code",{children:"ws://"})," automatically."]})]}),(0,o.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,o.jsx)("label",{htmlFor:"api-key",className:"block text-xs uppercase tracking-[0.18em] text-[color:var(--text-muted)]",children:"Gateway Token"}),(0,o.jsx)("input",{id:"api-key",type:"password",value:s,onChange:e=>i(e.target.value),placeholder:"Optional when connector handles auth",className:"oc-input"})]}),(0,o.jsx)("button",{type:"submit",disabled:d,className:"oc-button-secondary mt-4 w-full px-4 py-2.5 text-sm",children:d?"Connecting...":"Manual Connect"})]}),(0,o.jsxs)("section",{className:"oc-trust rounded-xl px-4 py-3 text-sm text-[color:var(--text-secondary)]",children:[(0,o.jsx)("p",{className:"oc-kicker text-[color:var(--cyan-bright)]",children:"Read-Only Safety"}),(0,o.jsx)("p",{className:"mt-2",children:"ClawBoard does not send tasks to your agent. It only reads usage telemetry for dashboards and leaderboards."})]}),y?(0,o.jsx)("p",{className:"rounded-lg border border-[color:var(--border-strong)] bg-[color:var(--coral-soft)] px-3 py-2 text-sm text-rose-100",children:y}):null]})}}},e=>{e.O(0,[619,441,255,358],()=>e(e.s=1213)),_N_E=e.O()}]);