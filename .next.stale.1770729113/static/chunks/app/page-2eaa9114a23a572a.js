(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{63:(e,t,a)=>{"use strict";var o=a(7260);a.o(o,"useParams")&&a.d(t,{useParams:function(){return o.useParams}}),a.o(o,"useRouter")&&a.d(t,{useRouter:function(){return o.useRouter}})},1213:(e,t,a)=>{Promise.resolve().then(a.bind(a,8746)),Promise.resolve().then(a.t.bind(a,2619,23))},8746:(e,t,a)=>{"use strict";a.d(t,{ConnectForm:()=>i});var o=a(5155),r=a(63),n=a(2115);let l=["http://127.0.0.1:18888","http://localhost:18888","http://127.0.0.1:18889","http://localhost:18889"],s=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1200,o=new AbortController,r=setTimeout(()=>o.abort(),a);try{return await fetch(e,{...t,signal:o.signal,cache:"no-store"})}finally{clearTimeout(r)}},c=async()=>{for(let e of l)try{let t=await s("".concat(e).concat("/v1/clawboard/discovery"));if(!t.ok)continue;let a=await t.json();if(!a||"object"!=typeof a)continue;return{origin:e,name:"string"==typeof a.name&&a.name.length>0?a.name:"Local Connector",version:"string"==typeof a.version&&a.version.length>0?a.version:"unknown",gatewayUrl:"string"==typeof a.gatewayUrl?a.gatewayUrl:void 0,hasGatewayToken:a.hasGatewayToken}}catch(e){}return null};function i(){let e=(0,r.useRouter)(),[t,a]=(0,n.useState)("ws://127.0.0.1:18789"),[l,i]=(0,n.useState)(""),[d,u]=(0,n.useState)(!1),[p,y]=(0,n.useState)(null),[m,h]=(0,n.useState)("probing"),[b,w]=(0,n.useState)(null),x=async(t,a)=>{var o,r,n;let l=await fetch("/api/connect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gatewayUrl:t.gatewayUrl,apiKey:null!=(o=t.apiKey)?o:""})});if(!l.ok)throw Error(null!=(r=(await l.json()).error)?r:"Failed to connect");let s=await l.json();localStorage.setItem("clawboard.token",s.anonymousToken),localStorage.setItem("clawboard.gatewayUrl",t.gatewayUrl),a.persistApiKey&&t.apiKey?localStorage.setItem("clawboard.apiKey",t.apiKey):localStorage.removeItem("clawboard.apiKey");let c=await fetch("/api/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({anonymousToken:s.anonymousToken,gatewayUrl:t.gatewayUrl,...t.apiKey?{apiKey:t.apiKey}:{}})});if(!c.ok)throw Error(null!=(n=(await c.json()).error)?n:"Connected but failed to sync usage");e.push("/dashboard")};(0,n.useEffect)(()=>{let e=!0;return(async()=>{let t=await c();if(e){if(!t){h("missing"),w(null);return}w(t),h("found"),t.gatewayUrl&&a(t.gatewayUrl)}})(),()=>{e=!1}},[]);let g=async e=>{e.preventDefault(),y(null),u(!0);try{await x({gatewayUrl:t,apiKey:l},{persistApiKey:!0})}catch(e){y(e instanceof Error?e.message:"Network error while connecting")}finally{u(!1)}},f=async()=>{if(b){y(null),u(!0);try{var e,t;let a=await s("".concat(b.origin).concat("/v1/clawboard/session"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scope:"usage.read"})},4e3);if(!a.ok){let t=await a.json().catch(()=>({}));throw Error(null!=(e=t.error)?e:"Local connector is reachable but session request failed")}let o=await a.json(),r=null!=(t=o.gatewayUrl)?t:b.gatewayUrl;if(!r)throw Error("Local connector did not provide a gateway URL");await x({gatewayUrl:r,apiKey:o.apiKey},{persistApiKey:!1})}catch(e){y(e instanceof Error?e.message:"One-click connector flow failed")}finally{u(!1)}}};return(0,o.jsxs)("form",{onSubmit:g,className:"space-y-4 rounded-3xl border border-[color:var(--border)] bg-[color:var(--bg-secondary)] p-6",children:[(0,o.jsxs)("section",{className:"rounded-2xl border border-[color:var(--border)] bg-black/20 p-4",children:[(0,o.jsx)("p",{className:"text-xs uppercase tracking-[0.18em] text-[color:var(--text-muted)]",children:"One-Click Local Connect"}),"probing"===m?(0,o.jsx)("p",{className:"mt-2 text-sm text-[color:var(--text-muted)]",children:"Looking for a local ClawBoard Connector..."}):null,"found"===m&&b?(0,o.jsxs)("div",{className:"mt-2 space-y-3",children:[(0,o.jsxs)("p",{className:"text-sm text-[color:var(--text-muted)]",children:["Detected ",(0,o.jsx)("span",{className:"text-white",children:b.name})," v",b.version," at ",b.origin]}),(0,o.jsx)("button",{type:"button",disabled:d,onClick:f,className:"w-full rounded-xl bg-emerald-400 px-4 py-2 text-sm font-semibold text-black transition hover:bg-emerald-300 disabled:cursor-not-allowed disabled:opacity-70",children:d?"Connecting...":"Connect Local OpenClaw"})]}):null,"missing"===m?(0,o.jsx)("p",{className:"mt-2 text-sm text-[color:var(--text-muted)]",children:"No local connector detected. You can still connect manually below."}):null]}),(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)("label",{htmlFor:"gateway-url",className:"block text-xs uppercase tracking-[0.18em] text-[color:var(--text-muted)]",children:"Gateway URL"}),(0,o.jsx)("input",{id:"gateway-url",type:"text",value:t,onChange:e=>a(e.target.value),placeholder:"ws://127.0.0.1:18789",className:"w-full rounded-xl border border-[color:var(--border)] bg-black/20 px-3 py-2 text-sm outline-none transition focus:border-emerald-400",required:!0}),(0,o.jsxs)("p",{className:"text-xs text-[color:var(--text-muted)]",children:["Use ",(0,o.jsx)("code",{children:"ws://localhost:18789"}),". ",(0,o.jsx)("code",{children:"http://"})," URLs are converted automatically."]})]}),(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)("label",{htmlFor:"api-key",className:"block text-xs uppercase tracking-[0.18em] text-[color:var(--text-muted)]",children:"Gateway Token"}),(0,o.jsx)("input",{id:"api-key",type:"password",value:l,onChange:e=>i(e.target.value),placeholder:"Optional if connector handles auth",className:"w-full rounded-xl border border-[color:var(--border)] bg-black/20 px-3 py-2 text-sm outline-none transition focus:border-emerald-400"})]}),p?(0,o.jsx)("p",{className:"rounded-lg bg-rose-900/35 px-3 py-2 text-sm text-rose-200",children:p}):null,(0,o.jsx)("button",{type:"submit",disabled:d,className:"w-full rounded-xl border border-emerald-400 px-4 py-2 text-sm font-semibold text-emerald-200 transition hover:bg-emerald-500/10 disabled:cursor-not-allowed disabled:opacity-70",children:d?"Connecting...":"Manual Connect"})]})}}},e=>{e.O(0,[619,441,255,358],()=>e(e.s=1213)),_N_E=e.O()}]);